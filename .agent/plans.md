## Purpose / Big Picture

- Care Hubの計画案ダウンロード機能を整備し、相談支援専門員が関係者と計画書を円滑に共有できるようにする。
- 計画案ページと共有ページの双方から自治体様式のExcelファイルを即時出力できる体験を提供する。
- 東京都中野区フォーマットに沿ったデータ出力を自動化し、手作業による転記やミスを削減する。

## Initial Requirements & Scope

- 対象ページ: `plans/[planid]/page` と `public/plans/[planid]/page` から同一のダウンロード手段を提供する。
- 出力形式: `.agent/nakanoku.xlsx` をベースにした東京都中野区の様式でExcelファイルを生成する。
- データソース: 計画案および利用者情報からExcelセルへのマッピングを決定論的に行う（自動入力可能な項目を明示）。
- スコープ内: 上記2ページのUI更新、サーバーアクションによるExcel生成、ダウンロードレスポンスの実装。
- スコープ外: 他自治体フォーマットの対応、PDF出力、オフライン編集機能。
- <unclear> 計画案／利用者情報とExcelセルの具体的マッピング仕様、LLM補助を許可する入力項目の基準。

## Milestones & Deliverables

| フェーズ | 主な成果物 | 完了基準 |
|-----------|-------------|-----------|
| 設計 | マッピング仕様、UIモック、技術検討メモ | 関係者レビュー完了、<unclear>項目の確定 |
| 実装 | ダウンロードボタン、サーバーアクション、Excel生成コード | Bunテスト/ローカル確認済み、主要シナリオ動作 |
| 検証 | テストケース、手動検証記録 | 異常系含むチェック完了、致命的バグ0 |
| リリース | リリースノート、反映手順 | デプロイ完了、関係者共有済み |

## Progress

- [x] [2025-10-20 11:00Z] プロジェクト開始：リポジトリ確認・ExecPlan初期化
- [ ] ステークホルダーへの要件ヒアリング、ユーザーストーリーと受入基準定義
- [ ] 開発環境構築：インフラ設定、依存関係インストール、コードベース初期化
- [ ] MVPスコープ定義と優先順位付け
- [x] コア機能実装（基本動作OK、エッジケース対応未完）
- [ ] 単体テスト作成と品質確認
- [ ] ピアレビュー実施と改善
- [ ] 結合テスト・デバッグ対応
- [ ] デプロイ計画、リリースノート、最終ドキュメント整備
- [ ] マイルストーンリリースとフィードバック収集

## Surprises & Discoveries

- サーバー環境で追加パッケージを導入できないため、Excelテンプレート編集はZip構造を手作りで解析・再構築する実装とした。

## Decision Log

- [2025-10-20] 初期リリースでは東京都中野区フォーマットのみ対応し、他自治体は将来拡張とする — 雛形が提供済みで最優先課題に集中するため
- [2025-10-20] ライブラリ追加が難しいため、Zip展開・再圧縮は独自実装とし、テンプレートのセル編集はinline stringで置換する方式を採用

## Outcomes & Retrospectives

- マイルストーン未完了のため記入なし
