# ヒアリングメモ機能 MVP設計書

## 1. MVP概要

### 1.1 コア体験
リアルタイム文字起こしとAI支援による共同ドキュメント作成で、ヒアリング内容を効率的に記録

**2つの主要機能:**
1. **リアルタイム文字起こし**: 音声をその場で文字に変換
2. **AI支援メモ**: リアルタイムでメモを取り、AIが内容を補完・整理

### 1.2 MVPワークフロー

```
ヒアリング開始
    ↓
共同ドキュメント作成開始
    ├─── リアルタイム文字起こし（Web Speech API）
    │        ↓
    │    サイドバーに表示
    │
    ├─── 手動入力（相談員）
    │        ↓
    │    ドキュメントに追記
    │
    └─── AI支援（リアルタイム）
             ↓
        ・内容の補完
        ・構造化提案
        ・重要ポイントのハイライト
             ↓
ヒアリング終了（ドキュメント確定）
    ↓
複数のヒアリングドキュメントを蓄積
```

## 2. ドメインモデル設計（MVP版）

### 2.1 HearingMemo集約

**責務**
- ヒアリングメモの作成・保存
- AI支援情報の保持

**主要プロパティ**
```typescript
interface HearingMemo {
  id: string
  clientId: string
  supporterId: string
  date: Date
  title: string       // ヒアリングタイトル
  content: {
    document: string  // Markdown形式の共同ドキュメント
    metadata: {       // ドキュメントのメタ情報
      sources: Array<{
        type: 'voice' | 'manual' | 'ai'
        timestamp: Date
        text: string
      }>
    }
    structured: {     // AI支援による構造化
      summary: string
      keywords: string[]
      keyPoints: string[]
      categories: {
        desires: string[]      // 希望・要望
        difficulties: string[] // 困りごと
        services: string[]     // 必要なサービス
        considerations: string[] // 配慮事項
      }
    }
  }
  createdAt: Date
  updatedAt: Date
}
```


## 3. 技術アーキテクチャ（MVP版）

### 3.1 フロントエンド構成

```
app/
└── clients/
    └── [clientId]/
        ├── page.tsx              # クライアント詳細
        └── hearing/
            ├── page.tsx          # ヒアリングメモ画面
            ├── collaborative-memo.tsx   # 共同ドキュメント編集
            ├── speech-recognition.tsx   # 音声認識コンポーネント
            └── ai-assistant.tsx         # AI支援表示
```

### 3.2 バックエンド構成

```
domain/
└── hearing-memo/
    ├── model.ts
    └── repository.ts

uc/
└── hearing/
    ├── save-memo.ts
    └── process-with-ai.ts

infra/
├── repositories/
│   └── hearing-memo.ts
└── ai/
    └── openai-service.ts  # GPT-4による支援
```

## 4. UI/UXデザイン

### 4.1 ヒアリングメモ画面

```
┌─────────────────────────────────────────┐
│  [← 戻る]  山田太郎さんのヒアリング        │
│                    2024/1/15 14:30       │
├─────────────────────────────────────────┤
│                                         │
│  [🎤 音声認識ON]  [保存]  [ヒアリング終了] │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │  共同ドキュメント                 │   │
│  ├─────────────────────────────────┤   │
│  │                                  │   │
│  │ ## 希望する生活                   │   │
│  │ [音声入力 14:32]                  │   │
│  │ 週3回デイサービスに通いたい。      │   │
│  │ 日中に人と話す機会がほしい。       │   │
│  │                                  │   │
│  │ [AI補完] 社会的交流の機会を       │   │
│  │ 増やしたいというニーズあり         │   │
│  │                                  │   │
│  │ ## 困っていること                  │   │
│  │ [手動入力 14:35]                  │   │
│  │ 家族の協力は限定的。              │   │
│  │ 息子は遠方に住んでいる。           │   │
│  │                                  │   │
│  │ ## 必要なサービス                  │   │
│  │ [AI提案]                         │   │
│  │ ・デイサービス（週3回）            │   │
│  │ ・送迎サービス                   │   │
│  │ ・緊急時の連絡体制構築            │   │
│  │                                  │   │
│  │ カーソル位置｜                    │   │
│  └─────────────────────────────────┘   │
│                                         │
│  AI支援サイドバー                       │
│  ┌─────────────────────────────────┐   │
│  │ 💡 提案                          │   │
│  │ • 送迎付きデイサービスを検討      │   │
│  │ • 緊急連絡先の確認が必要         │   │
│  │                                  │   │
│  │ 📝 次に聞くとよいこと             │   │
│  │ • 現在の移動手段                 │   │
│  │ • 緊急時の連絡先                 │   │
│  └─────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

## 5. 実装計画

### Phase 1: 基盤構築
- [ ] ドメインモデル実装（HearingMemo）
- [ ] 基本的なCRUD操作
- [ ] データベーススキーマ作成

### Phase 2: ヒアリング機能
- [ ] リアルタイム文字起こし（Web Speech API）
- [ ] メモパッドUI
- [ ] メモの保存・取得

### Phase 3: AI支援機能
- [ ] gemini flash API連携
- [ ] メモの構造化・キーワード抽出
- [ ] リアルタイムAI支援表示
- [ ] 重要ポイントの自動抽出

## 6. 技術選定

### 音声処理
- **Web Speech API**: リアルタイム文字起こし（Chrome/Edge）

### AI支援
- **Gemini flash**: メモの構造化と計画書生成
- **Streaming対応**: リアルタイムフィードバック

### データ管理
- **PostgreSQL + Prisma**: メモと計画書の永続化
- **JSON型**: 柔軟な構造化データ保存

### 技術的リスク
- **音声認識精度**: 手動修正機能で補完
- **AI応答遅延**: ローカルキャッシュとストリーミング対応
- **ブラウザ互換性**: Chrome/Edgeを推奨環境とする
